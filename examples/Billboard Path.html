<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>带尾迹线移动路径</title>
    <link rel="stylesheet" href="../Build/Cesium-1.56.1/Widgets/widgets.css">
    <link rel="stylesheet" href="css/all.css">
    <style>
        #cesiumContainer {
            width: 100%;
            height: 100%;
        }

        #toolbar {
            position: absolute;
            left: 0;
            top: 0;
            /*background: #fff;*/
        }
    </style>
</head>
<body>
<div id="cesiumContainer"></div>
<script src="../../Build/jquery.js"></script>
<script src="../Build/Cesium-1.56.1/Cesium.js"></script>
<script src="js/stats.min.js"></script>
<script src="js/Custom_Entitys.js"></script>
<script>
    var viewer, position, bill;
    var lngUp = 0.00001;
    var latUp = 0.00001;
    var beforTime = 0;

    var train = {
        "type": "GeometryCollection",
        "geometries": [{
            "type": "LineString",
            "coordinates": [[114.1751267, 30.639174599999997], [114.1768004, 30.6395531], [114.17814149999998, 30.6398946], [114.1792465, 30.640328499999995], [114.1800404, 30.640753099999998], [114.1807378, 30.641214599999998], [114.181285, 30.6416946], [114.1821755, 30.642322299999996], [114.1831626, 30.6428485], [114.1835649, 30.643014599999997], [114.1840638, 30.643171499999998], [114.1847397, 30.643342299999997], [114.1855335, 30.6434946], [114.1863866, 30.643573099999998], [114.188012, 30.6436515], [114.1883208, 30.6435996], [114.18877909999999, 30.6436561], [114.18937459999998, 30.6436423], [114.1899056, 30.643586900000003], [114.1905064, 30.6434715], [114.1922499, 30.64313], [114.1948731, 30.642608499999998], [114.1994359, 30.6416887], [114.2019863, 30.6411823], [114.2035794, 30.6408546], [114.2046417, 30.6406885], [114.2055106, 30.6406054], [114.2065622, 30.6406146], [114.207045, 30.640656199999995], [114.2081447, 30.640840799999996], [114.2102958, 30.641385399999997], [114.2109931, 30.64151], [114.21194799999999, 30.641528500000003], [114.2127848, 30.6414362], [114.2150004, 30.6409285], [114.217677, 30.6402998], [114.2194143, 30.6398643], [114.2203575, 30.6396904], [114.2206975, 30.639776], [114.22108899999999, 30.6400377], [114.2215502, 30.6405915], [114.22219409999998, 30.641606899999996], [114.2229129, 30.642299199999997], [114.2235244, 30.642649999999996], [114.22399639999999, 30.6427608], [114.224447, 30.6427885], [114.2251552, 30.642733099999997], [114.22551499999999, 30.642678200000002], [114.2261567, 30.642580399999996], [114.228862, 30.6421427], [114.2317749, 30.6416715], [114.23310529999999, 30.641459199999996], [114.2338914, 30.641465], [114.23456439999998, 30.641542299999998], [114.23524029999999, 30.641763799999996], [114.2360234, 30.6421238], [114.2371565, 30.6426981], [114.2387916, 30.643526899999998], [114.24106599999999, 30.644643799999997], [114.24310459999998, 30.6449669], [114.2448426, 30.6451607], [114.2473317, 30.6451607], [114.24914489999999, 30.644999199999997], [114.2503895, 30.6447223], [114.25123699999999, 30.6441407], [114.252149, 30.642991499999997], [114.2549385, 30.639151499999997], [114.2564065, 30.6371905], [114.2579426, 30.6351636], [114.2608929, 30.6317202], [114.2621456, 30.6298808], [114.2627463, 30.6288099], [114.2631969, 30.6279052], [114.26426989999999, 30.624415400000004], [114.2643742, 30.6241164], [114.2647888, 30.6229281], [114.2648224, 30.622832], [114.2652703, 30.621675599999996], [114.2659061, 30.6201268], [114.2674429, 30.6157434], [114.2677031, 30.6150163], [114.2678855, 30.6145777], [114.26823949999999, 30.6141622], [114.2683361, 30.614055999999998], [114.2684541, 30.6139452], [114.2686901, 30.6137421], [114.2688779, 30.613622], [114.26907089999999, 30.6134974], [114.2702886, 30.6129068], [114.2714582, 30.6123247], [114.2722654, 30.6119208], [114.27317749999999, 30.6114268], [114.27463379999999, 30.6105703], [114.2749451, 30.610387999999997], [114.27665629999998, 30.6093238], [114.27817979999999, 30.6083727], [114.2784158, 30.608206499999998], [114.2784749, 30.6081626], [114.2789523, 30.607788599999996], [114.2792312, 30.6075924], [114.2797569, 30.6070799], [114.2803363, 30.606542], [114.2807065, 30.6061934], [114.2811383, 30.6058171], [114.2814441, 30.6054732], [114.2815862, 30.6053023], [114.2825357, 30.6042866], [114.2828415, 30.6039472], [114.283158, 30.603522399999996], [114.28353079999998, 30.603005299999996], [114.28385269999998, 30.602562], [114.2839305, 30.602418899999996], [114.2841772, 30.601959499999996], [114.28441329999998, 30.601493099999995], [114.2848585, 30.6002511], [114.28495499999998, 30.6000248], [114.2850998, 30.5997616], [114.2852716, 30.5994615], [114.2860065, 30.598524199999996], [114.2862907, 30.598191699999997], [114.2866449, 30.597739199999996], [114.28695059999998, 30.5974067], [114.2877767, 30.5966725], [114.2880824, 30.5964047], [114.2881898, 30.5962662], [114.2882649, 30.596003], [114.2887316, 30.5946962], [114.28901329999998, 30.5936157], [114.2889811, 30.5927891], [114.2889702, 30.5925398], [114.2886968, 30.590023099999996], [114.2884285, 30.587977299999995], [114.2881684, 30.587032899999997], [114.2879966, 30.5865457], [114.28774989999998, 30.585956999999997], [114.2874469, 30.585245799999996], [114.2871143, 30.5844191], [114.28690239999999, 30.583918099999998], [114.2868568, 30.5838142], [114.2865322, 30.583389300000004], [114.28648929999999, 30.5833316], [114.2862448, 30.5829985], [114.28570329999998, 30.5822809], [114.2848101, 30.580962400000004], [114.28446959999998, 30.580440500000005], [114.2843622, 30.5802927], [114.2837191, 30.5798966], [114.28320089999998, 30.5795746], [114.2820582, 30.5789442], [114.281031, 30.578396899999998], [114.279993, 30.577935099999998], [114.27834329999999, 30.5772862], [114.2769606, 30.576671000000005], [114.2754546, 30.5760692], [114.2743334, 30.5755288], [114.27394459999998, 30.575297899999995], [114.2731668, 30.574972299999995], [114.2717595, 30.5746196], [114.27013859999998, 30.5741294], [114.2698945, 30.574043999999997], [114.26861759999998, 30.5735013], [114.2680973, 30.5732519], [114.2663887, 30.5725568], [114.2654769, 30.5721803], [114.2650397, 30.572011699999997], [114.2647822, 30.571951700000003], [114.2644308, 30.5719078], [114.2642833, 30.5719009], [114.26287349999998, 30.571846999999998], [114.2621535, 30.571806199999997], [114.2588142, 30.5716053], [114.2584494, 30.5715314], [114.2578272, 30.571291199999997], [114.25723709999998, 30.5709679], [114.25685089999999, 30.570506], [114.2567007, 30.5697855], [114.2558907, 30.564575299999998], [114.2557619, 30.563780899999998], [114.2558171, 30.563517199999996], [114.2559265, 30.563183599999995], [114.2570532, 30.5622774], [114.2576663, 30.5617669], [114.2582938, 30.5611064], [114.2586963, 30.560570499999997], [114.2588946, 30.560113199999996], [114.25913379999999, 30.559567599999998], [114.2592917, 30.559161599999996], [114.2601499, 30.555595500000003], [114.26045029999999, 30.5540987], [114.2605952, 30.5533827], [114.2606005, 30.553156299999998], [114.2606005, 30.552260100000005], [114.26070789999999, 30.550633999999995], [114.2607347, 30.550070399999996], [114.26083129999999, 30.5482132], [114.2609118, 30.546268199999997], [114.26102979999999, 30.5445519], [114.26118529999998, 30.542657699999996], [114.26134079999999, 30.540532399999996], [114.26145889999998, 30.5391325], [114.26159839999998, 30.537353699999997], [114.2616091, 30.536997899999996], [114.26159839999998, 30.5368639], [114.2615448, 30.536753], [114.26145889999998, 30.5366236], [114.260268, 30.5353807], [114.258192, 30.533218300000005], [114.2569045, 30.531882999999997], [114.2545507, 30.529469599999995], [114.25318149999998, 30.528117099999996], [114.2524038, 30.5273547], [114.2501883, 30.524970299999996], [114.2484797, 30.5231889], [114.2476616, 30.522391799999998], [114.2440782, 30.518724899999995], [114.2398618, 30.514397], [114.2396257, 30.5141936], [114.2386602, 30.513583599999997], [114.2380808, 30.5132878], [114.2373941, 30.513029000000003], [114.2354844, 30.5127887], [114.233875, 30.512345], [114.2326734, 30.511425299999996], [114.23115, 30.509123799999998], [114.2288433, 30.505185999999995], [114.2269656, 30.5028658], [114.22559779999999, 30.501308099999996], [114.2254476, 30.501151], [114.22362909999998, 30.498997099999997], [114.2221163, 30.497263699999998], [114.22034069999998, 30.495239199999997], [114.2198954, 30.494703], [114.2196164, 30.494573500000005], [114.2191337, 30.4944534], [114.2185865, 30.494508800000002], [114.20875889999999, 30.497725899999995], [114.20655949999998, 30.498400799999995], [114.2061196, 30.4986504], [114.20378069999998, 30.5001018], [114.2014418, 30.5015624], [114.2003689, 30.502283399999996], [114.1999183, 30.502431299999998], [114.19890979999998, 30.5023758], [114.19820169999998, 30.502154000000004], [114.1787932, 30.497235999999997], [114.1783748, 30.4971805], [114.178053, 30.4972175], [114.1755852, 30.4977814], [114.1677425, 30.4996026], [114.1655914, 30.5001156], [114.16501209999998, 30.5003051], [114.16437359999999, 30.5005779], [114.1640411, 30.5007858], [114.1611229, 30.502491399999997]]
        }]
    };

    $(function () {
        init();
    });

    function init() {
        viewer = new Cesium.Viewer('cesiumContainer', {
            shouldAnimate: true
        });

        //帧插件
        stats = new Stats();
        document.body.appendChild(stats.dom);

        //单路线实现移动方式
        movebillboard();


        viewer.dataSources.add(Cesium.GeoJsonDataSource.load(train, {
            stroke: Cesium.Color.BLACK,
            fill: Cesium.Color.BLACK,
            strokeWidth: 3,
            markerSymbol: 'train'
        }));

    }

    function movebillboard(option) {
        var lng = 110;
        var lat = 40;
        var height = 0;
        var pathPosition = new Cesium.SampledPositionProperty();
        this.entityPath = undefined;
        viewer.entities.add({
            position: pathPosition,
            name: 'path',
            path: {
                show: true,
                leadTime: 60,   //指定要显示的对象后面的秒数
                trailTime: 60,  //指定要显示的对象前面的秒数
                width: 5,
                resolution: 1,  //步进采用的最大秒速
                material: new Cesium.StripeMaterialProperty({
                    evenColor: Cesium.Color.AQUAMARINE,
                    oddColor: Cesium.Color.AQUA.withAlpha(0),
                    repeat: 1,
                    offset: 0.85,//0.55,
                    orientation: Cesium.StripeOrientation.VERTICAL
                }),
            }
        });

        bill = viewer.entities.add({
            name: 'bill',
            position: Cesium.Cartesian3.fromDegrees(lng, lat, height),
            billboard: {
                show: true,
                scale: 0.5,
                image: 'images/cart.png',
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                // pixelOffset: new Cesium.Cartesian2(-100, 0)
            }
        });

        viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(114.1751267, 30.639174599999997, 100),   //经度不变 纬度位置降低 高度降低
            duration: 1,
            easingFunction: Cesium.EasingFunction.LINEAR_NONE,
            complete: function () {
            }
        });

        var temp = 0;
        var begin, end, point;
        viewer.scene.preUpdate.addEventListener(function (scene, time) {
            stats.update();

            var chas = time.secondsOfDay - beforTime;
            // console.log(chas + '毫秒');


            if (chas >= 1) {
                beforTime = time.secondsOfDay;
                // console.log('时间过去了1秒');

                if (temp+1 == train.geometries[0].coordinates.length) {
                    temp = 0;
                }

                begin = train.geometries[0].coordinates[temp];
                end = train.geometries[0].coordinates[temp + 1];
                point = lastparam(begin, end);

                temp++;
            }else{
                position = Cesium.Cartesian3.fromDegrees(begin[0] + (point[0] * chas), begin[1] + (point[1] * chas), 0.5);
                bill.position = position;
                pathPosition.addSample(Cesium.JulianDate.now(), position);
            }

        });

    }


    function lastparam(begin, end) {
        var lng = end[0] - begin[0];
        var lat = end[1] - begin[1];
        return [lng, lat];
    }


</script>
</body>
</html>